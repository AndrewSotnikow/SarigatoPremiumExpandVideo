"use strict";var SatakuTracking=function(){var e={action:{},redirect:{},wasDisplayClickPixelSent:!1,getNewLinks:function(){if(console.log("new link",t.config.campaign.campaignId),window.SatakuNewLinks=[""],window.SatakuNewCustoms=[""],DEBUG_MODE)return void e.load();e.MSSClicksAPI(),e.MSSCustomAPI()},MSSClicksAPI:function(){console.log("sending info to MSS Click"),window.savedOldLinks={MSSisActive:!1,redirects:e.redirect.lp,customs:e.action.custom},console.log(window.savedOldLinks);var i=new XMLHttpRequest,a=function(i){i.data.map(function(e){var i=Date.now();window.SatakuNewLinks.push(e.url.replace("[id_smart_insertion]",t.config.campaign.insertionId).replace("[timestamp]",i))}),window.SatakuNewLinks.map(function(t,i){e.redirect.lp[i]=t})};i.onreadystatechange=function(){if(4===i.readyState)if(i.status>=200&&i.status<300){var t=JSON.parse(i.responseText);t&&t.Success&&t.data&&t.data.length>0?(console.log("MSS Click reply success",t),t.data.using_smart?e.MSSFallback():a(t),window.savedOldLinks.MSSisActive=!0):console.log("MSS Click reply error",i),e.load()}else console.log("MSS Click reply error",i),e.load()},i.open("GET","https://click.sataku.com/api/get_urls/"+t.config.campaign.campaignId),i.send()},MSSFallback:function(){window.savedOldLinks.MSSisActive=!1,e.redirect.lp=window.savedOldLinks.redirects,e.action.custom=window.savedOldLinks.customs},MSSCustomAPI:function(){console.log("sending info to MSS Customs");var i=new XMLHttpRequest,a=function(i){i.data.map(function(e){var i=Date.now();window.SatakuNewCustoms.push(e.url.replace("[id_smart_insertion]",t.config.campaign.insertionId).replace("[timestamp]",i))}),window.SatakuNewCustoms.map(function(t,i){e.action.custom[i]=t})};i.onreadystatechange=function(){if(4===i.readyState)if(i.status>=200&&i.status<300){var t=JSON.parse(i.responseText);t&&t.Success&&t.data&&t.data.length>0?(console.log("MSS Custom reply success",t),a(t)):console.log("MSS Custom reply error",i),e.load()}else console.log("MSS Custom reply error",i),console.log(e),e.load()},i.open("GET","https://video.sataku.com/api/get_urls/"+t.config.campaign.campaignId),i.send()},displayLoad:function(){t.debug.log("displayLoad")},displayClick:function(){if(e.wasDisplayClickPixelSent)return void console.log("not first displayClick, not sending pixels");e.wasDisplayClickPixelSent=!0,t.debug.log("displayClick"),t.pixel(e.action.openExpand),t.config.deviceType===DEVICE_TYPE_DESKTOP?t.pixel("https://track.adform.net/Serving/TrackPoint/?pm=1681851&lid=53543605"):t.config.deviceType===DEVICE_TYPE_MOBILE&&t.pixel("https://track.adform.net/Serving/TrackPoint/?pm=1681851&lid=53545814"),t.config.publisher.tracking.click&&t.pixel(t.config.publisher.tracking.click),t.config.publisher.trackingAll.click&&t.pixel(t.config.publisher.trackingAll.click)},endboard:function(){t.debug.log("endboard")},videoMute:function(e){t.debug.log("videoMute",e)},videoUnmute:function(e){t.debug.log("videoUnmute",e)},videoQuartile:function(i,a){t.debug.log("quartile",i,a),window.savedOldLinks.MSSisActive&&i<=3?t.pixel("//video.sataku.com/tracking/video/2/"+t.config.campaign.insertionId+"/"+(a+1)+"/"+i+"/[TIMESTAMP]"):t.pixel(e.action.video[i]["quartile"+a])},videoStart:function(i){t.debug.log("videoStart",i),window.savedOldLinks.MSSisActive&&i<=3?t.pixel("https://video.sataku.com/tracking/video/2/"+t.config.campaign.insertionId+"/1/"+i+"/[TIMESTAMP]"):t.pixel(e.action.video[i].start)},videoEnd:function(i){t.debug.log("videoEnd",i),window.savedOldLinks.MSSisActive&&i<=3?t.pixel("https://video.sataku.com/tracking/video/2/"+t.config.campaign.insertionId+"/5/"+i+"/[TIMESTAMP]"):t.pixel(e.action.video[i].end)},rvFirstInView:function(){t.debug.log("rvFirstInView")},dwellCount:function(e){t.debug.log("dwellTime",e),t.pixel(PIXEL_BASE_URL+"czas/dwell.php?id_smart="+t.config.campaignId+"&user="+t.config.SAS.campaign.timestamp+"&czas="+e+"&id_insercja="+t.config.insertionId)},load:function(){var t=document.stkQuery('a[href="{social_facebook}"]',!0),i=document.stkQuery('a[href="{social_twitter}"]',!0),a=document.stkQuery('a[href="{social_googleplus}"]',!0),n=function(e,t){e.stkAttr({href:t,target:"_blank"})};for(var o in e.redirect.lp)for(var r=document.stkQuery('a[href="{redirect_'+o+'}"]',!0),c=0;c<r.length;c++)n(r[c],e.redirect.lp[o]);t.stkIterate(function(t){n(t,e.redirect.social.facebook)}),i.stkIterate(function(t){n(t,e.redirect.social.twitter)}),a.stkIterate(function(t){n(t,e.redirect.social.google)})}},t={config:{},baseUrl:String("https://www3.smartadserver.com/"),debug:new SatakuLogger({log:{quartile:["{Tracking} Video %s quartile %s",SatakuLogger.prototype.stylesheet.tracking],videoEnd:["{Tracking} Video %s ended",SatakuLogger.prototype.stylesheet.tracking],videoStart:["{Tracking} Video %s first start",SatakuLogger.prototype.stylesheet.tracking],videoMute:["{Tracking} Video %s muted",SatakuLogger.prototype.stylesheet.tracking],videoUnmute:["{Tracking} Video %s unmuted",SatakuLogger.prototype.stylesheet.tracking],VDSinit:["{Tracking} Display VDS Init",SatakuLogger.prototype.stylesheet.tracking],rvFirstInView:["{Tracking} RV first in view",SatakuLogger.prototype.stylesheet.tracking],endboard:["{Tracking} Endboard",SatakuLogger.prototype.stylesheet.tracking],displayLoad:["{Tracking} Display Load",SatakuLogger.prototype.stylesheet.tracking],displayClick:["{Tracking} Display Click",SatakuLogger.prototype.stylesheet.tracking],dwellTime:["{Tracking} Dwell Time %s",SatakuLogger.prototype.stylesheet.tracking]}}),getCreative:function(e){return void 0===t.config.SAS.creative[e]?null:t.config.SAS.creative[e]},getOrCreateLink:function(e){return e==parseInt(e,10)?t.createSmartLink(e):e},pixel:function(e,t){return e?(e=e.replace("[timestamp]",stkGetRandomInt()),e=e.replace("[TIMESTAMP]",stkGetRandomInt()),"https"!=e.split(":")[0]&&DEBUG_MODE&&console.warn("Https tracking warn!"),SATAKU_MODE!=MODE_DEVELOPER||PIXELS_LOCAL_TESTING_MODE?((new Image).src=e,void(DEBUG_MODE&&console.log("Pixel: ",e,t))):void console.log("Tracking pixel excluded: "+e)):void console.error("Empty URL. Tracking excluded.")},script:function(e){if(e=e||function(){},e.constructor!==Function)throw new Error("Tracking script is not a function.");if(SATAKU_MODE==MODE_DEVELOPER&&!PIXELS_LOCAL_TESTING_MODE)return void console.log("Tracking script excluded.");e()},iframe:function(e){if(!e)throw new Error("Empty URL. Tracking excluded.");if(SATAKU_MODE==MODE_DEVELOPER&&!PIXELS_LOCAL_TESTING_MODE)return void console.log("Tracking iframe excluded.");var t=document.createElement("iframe");e=e.replace("[timestamp]",stkGetRandomInt()),e=e.replace("[TIMESTAMP]",stkGetRandomInt()),t.stkAttr({frameborder:"0",width:"0",src:e,height:"1"}),t.style.display="none",t.appendTo("body")},createSmartLink:function(e){return void 0===t.config.SAS.programmatic&&(t.config.SAS.programmatic={}),decodeURIComponent(t.config.SAS.programmatic.clickTracking||"")+this.baseUrl+"call/cliccommand/"+e+"/"+stkGetRandomInt()},createSmartPixel:function(e){return this.baseUrl+"imp?imgid="+e+"&tmstp="+stkGetRandomInt()+"&tgt=[targeting]"},createRedirectPixel:function(e){return this.baseUrl+"call/clicpixel/"+e+"/"+stkGetRandomInt()+"?"}};return function(i){SatakuTracking=null,t.config=i,e.redirect={lp:{},social:{facebook:t.getOrCreateLink(t.getCreative(1)),twitter:t.getOrCreateLink(t.getCreative(2)),google:t.getOrCreateLink(t.getCreative(3)),pinterest:t.getOrCreateLink(t.getCreative(4))}},e.action={openExpand:t.createSmartPixel(t.getCreative(1)),video:{},custom:{},displayLoad:null,displayClick:null,displayVSDstart:Function};for(var a=1;a<=16;a++)e.redirect.lp[a]=t.getOrCreateLink(t.getCreative(a+5));for(var n=1;n<=5;n++)e.action.custom[n]=t.createSmartPixel(t.getCreative(n+16));for(var o=0;o<3;o++)e.action.video[o+1]={start:t.createSmartPixel(t.getCreative(5*o+2)),quartile1:t.createSmartPixel(t.getCreative(5*o+3)),quartile2:t.createSmartPixel(t.getCreative(5*o+4)),quartile3:t.createSmartPixel(t.getCreative(5*o+5)),end:t.createSmartPixel(t.getCreative(5*o+6)),videoTime:0,currentQuartile:0,firstPlay:!0,player:null};return e.stkExt({pixel:t.pixel,script:t.script,iframe:t.iframe})}}();